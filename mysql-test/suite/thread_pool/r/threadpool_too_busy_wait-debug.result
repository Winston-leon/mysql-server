CREATE DATABASE db1;
CREATE TABLE db1.t1 (
c1 int NOT NULL,
c2 int NOT NULL,
PRIMARY KEY (c1)
);
INSERT INTO db1.t1 (c1,c2) VALUES (1,11);
INSERT INTO db1.t1 (c1,c2) VALUES (2,22);
INSERT INTO db1.t1 (c1,c2) VALUES (3,33);
START TRANSACTION;
SELECT * FROM db1.t1 WHERE c1=2 FOR UPDATE;
c1	c2
2	22
START TRANSACTION;
SELECT * FROM db1.t1 WHERE c1=2 LOCK IN SHARE MODE;
START TRANSACTION;
SELECT * FROM db1.t1 WHERE c1=2 LOCK IN SHARE MODE;
SELECT 1;
queue_length 0
1
1
SELECT 1;
queue_length 0
1
1
SET GLOBAL debug="+d,threadpool_io_poll_wait_at_least_2_events";
SELECT 1;
SET GLOBAL debug="-d,threadpool_io_poll_wait_at_least_2_events";
SELECT 1;
queue_length 1
SELECT SUM(CONNECTIONS) FROM INFORMATION_SCHEMA.THREAD_POOL_GROUPS;
SUM(CONNECTIONS)
6
SELECT SUM(ACTIVE_THREADS) FROM INFORMATION_SCHEMA.THREAD_POOL_GROUPS;
SUM(ACTIVE_THREADS)
0
SELECT SUM(STANDBY_THREADS) FROM INFORMATION_SCHEMA.THREAD_POOL_GROUPS;
SUM(STANDBY_THREADS)
2
SELECT SUM(QUEUE_LENGTH) FROM INFORMATION_SCHEMA.THREAD_POOL_GROUPS;
SUM(QUEUE_LENGTH)
1
SELECT SUM(HAS_LISTENER) FROM INFORMATION_SCHEMA.THREAD_POOL_GROUPS;
SUM(HAS_LISTENER)
1
SELECT SUM(IS_STALLED) FROM INFORMATION_SCHEMA.THREAD_POOL_GROUPS;
SUM(IS_STALLED)
1
SELECT COUNT(*) FROM INFORMATION_SCHEMA.THREAD_POOL_QUEUES;
COUNT(*)
1
ROLLBACK;
c1	c2
2	22
ROLLBACK;
c1	c2
2	22
ROLLBACK;
1
1
1
1
Clean up
DROP TABLE db1.t1;
DROP DATABASE db1;
